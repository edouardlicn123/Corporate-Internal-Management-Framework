以下是更新后的开发计划书，在原内容基础上完整保留原有章节，并在最后增加了一个全新的章节：

**9. 前端界面框架架构设计**

```markdown
FFE 项目跟进系统  
开发计划书（总体版）

当前日期：2026年2月11日  
项目名称：FFE 项目跟进系统  
所属领域：酒店家具项目管理与计算工具  
技术栈：后端 Python + Flask，前端基于 HTML + CSS + JavaScript（继承系统模板）  
开发范围：构建一套内部工具型系统，用于 FFE 项目全程跟进，支持计算统一、数据保存、团队协作、报价生成等功能

重要说明：
- 本文档为**总体规划**，仅概述系统全貌和模块优先级
- 每个功能模块（尤其是计算器）将**单独编写一份详细分支计划书**，包含具体需求、页面布局、输入输出、计算逻辑、交互细节、验收标准等
- 本文档中不再包含已取消的功能（PDF 导出、打包 exe 计划）

1. 系统定位与核心价值

主要使用者：项目经理 + 项目成员（全程共同使用）  
- 项目经理：主导项目跟进，包括创建项目、发起计算、上传文件、更新状态、导出报价单等核心操作
- 项目成员：协助项目经理，一起查看项目信息、查看计算记录、查看文件、查看进度等（视权限可参与部分编辑）

使用环节：项目跟进全程（从立项、报价、包装设计、物流计划、清关估算、到货跟踪、项目归档）

核心痛点解决（按优先级排序）：
- 计算不统一（不同人用不同 Excel、不同公式）
- 数据容易丢失（Excel 散乱、邮件附件找不到）
- 沟通效率低（计算结果难以快速分享、版本混乱）
- 报价出错（手动计算失误、税费漏算）

系统目标：通过统一的在线工具，实现项目数据集中管理、计算标准化、团队实时协作、快速生成报价单，提高整体效率并减少错误。

2. 功能模块优先级与范围（总体概览）

| 优先级 | 模块名称                          | 状态与说明                                                                 | 是否有独立分支计划书 |
|--------|-----------------------------------|-----------------------------------------------------------------------------|----------------------|
| 1      | KD 包装体积计算器                 | 已提供 HTML，已规划                                                         | 是（已完成）         |
| 2      | 运费计算器（整合版）              | 整合吉布提、达曼/迪拜、基加利，支持切换目的港/国家，含税费、额外费用勾选、截图下载 | 是（待编写）         |
| 3      | 项目基本信息管理                  | 项目列表、新建/编辑项目（项目名、客户、目的港、柜数、船期、备注、成员分配等） | 是（待编写）         |
| 4      | 计算结果保存与项目关联            | 每个项目可保存多条计算记录（体积、运费等），按时间/类型展示                 | 是（待编写）         |
| 5      | 项目汇总视图                      | 按项目显示总体积、总运费、总税费、总成本估算，支持简单对比                   | 是（待编写）         |
| 6      | 生成报价单 / 运费明细单           | 支持 Excel 导出（含项目信息、计算明细、税费、总价）                         | 是（待编写）         |
| 7      | 文件上传与关联                    | 项目可上传图纸、合同、装箱单、照片等，存入持久化目录，支持查看/下载         | 是（待编写）         |
| 8      | 进度跟踪（状态管理）              | 项目状态：报价中 → 已打包 → 已发货 → 已到港 → 已清关 → 已交付，含历史记录 | 是（待编写）         |
| 9      | 客户/联系人管理                   | 简单客户库（姓名、公司、邮箱、电话、WhatsApp 等），可关联多个项目           | 是（待编写）         |
| 10     | 提醒/待办事项                     | 项目级待办、邮件提醒                                                         | 是（待编写）         |
| 11     | 版本对比（计算历史对比）          | 同项目不同时间点的计算结果对比（体积变化、费用变化）                         | 是（待编写）         |

- 每个功能模块都将**单独输出一份详细分支计划书**，包括：
  - 具体功能需求
  - 页面布局与交互细节
  - 输入输出字段
  - 计算逻辑（若适用）
  - 权限控制点
  - 验收标准
  - 与其他模块的关联方式

3. 数据保存与组织方式

核心组织单位：项目（Project）  
每个项目包含：  
- 基本信息（项目名、客户、目的港、柜数、船期、状态、项目经理、成员列表、备注）  
- 多条计算记录（体积计算、运费计算等，按时间戳保存，支持类型标签、备注）  
- 关联文件（上传的图纸、合同等）  
- 进度状态 + 历史记录  
- 待办事项列表  

- 计算结果必须保存：每个项目保存多条记录，按“项目”组织  
- 版本对比：远期可能需要（每条计算记录带版本号/时间戳，支持对比视图）  

数据存储：SQLite 数据库（site.db）

4. 登录与权限

- 系统所有页面必须登录，未登录跳转到登录页  
- 角色：管理员 + 项目经理 + 项目成员  
- 权限动态配置：项目经理和项目成员的权限后台可修改，非写死  

权限管理页面（/admin/permissions，仅管理员可见）：  
- 用户列表与角色分配：显示所有用户，可勾选/移除角色（多选），支持搜索/批量操作  
- 角色权限配置：每个角色有独立权限列表（复选框勾选），分类包括项目管理、计算工具、文件与导出、进度管理、用户与权限、系统设置  
- 保存即时生效：修改后所有用户立即应用  

权限检查：使用装饰器动态校验（has_permission(user, 'create_project')）。

5. 界面风格与体验

- 整体风格：内部工具型（实用优先，简洁、专业）  
- 导航栏：顶部菜单（首页/仪表盘、我的项目、计算工具、待办事项、个人中心、管理员专属菜单）  
- 计算器页面：继承 base.html，顶部导航栏 + 计算器核心内容 + 底部 footer  
- 仪表盘：显示“我负责的项目” + “我参与的项目” + 待办事项 + 快速入口（新建项目、新计算）  
- 项目详情页：基本信息 + 计算记录列表 + 文件列表 + 进度时间线 + 操作按钮（权限控制）  

6. 技术路线

- 后端：route + service + template 架构（route 处理请求/渲染，service 处理逻辑/计算，template 继承 base.html）  
- 数据库：SQLite（site.db），新增 Project、CalculationRecord、FileAttachment、Todo、Role、Permission 等表  
- 登录：复用 Flask-Login + User 模型  
- 权限：新增 Role 和 Permission 表，多对多关联  
- 导出：Excel（openpyxl）、截图（html2canvas）  
- 路径兼容：复用原路径处理（persistent uploads、instance_path）  
- 主题：继承原主题系统（计算器页面可应用统一主题）  
- code2ai AI review 系统：  
  - 复用原项目的 code2ai.py 和 code2ai_config.toml  
  - 用途：开发过程中一键生成源码审查文件，便于 AI 分析、优化和迭代代码  
  - 位置：app/utils/code2ai.py  
  - 配置：code2ai_config.toml（定义文件清单、排除规则）  
  - 使用方式：在启动脚本中提供选项，运行后生成 txt 文件（包含文件清单 + 代码内容）  
- 启动脚本：  
  - run.sh（Linux/macOS）：一键管理（创建 venv、安装依赖、运行服务器、初始化数据库、运行 code2ai 等）  

7. 后续扩展性考虑

- 运费计算器：支持后续新增国家/港口（配置化参数，不改代码）  
- 其他扩展：根据项目需求，可加更多计算器或模块（权限页面支持新权限项）  

8. 备注

- 系统初期聚焦核心计算 + 项目管理，后续迭代扩展客户/提醒等  
- 所有计算结果含税费/额外费用，支持手动调整参数  
- 初始化：默认管理员 + 示例项目数据  
- 测试重点：权限生效、数据关联、导出格式正确  
- 开发顺序建议：登录 + 权限管理 → 项目管理 → 计算器整合 → 保存/汇总 → 导出 → 文件/进度  
- 每个功能模块均有独立分支计划书，详细描述具体实现细节  

9. 前端界面框架架构设计（2026年2月11日最新状态）

**设计目标**  
- 建立现代、统一、可维护的管理后台风格界面
- 实现导航栏显示/隐藏可控（登录页等公共页面不显示 nav）
- 支持主题变量驱动，当前实现 default 主题（主色 #2563eb）
- 减少对 Bootstrap 类名的硬编码依赖，核心视觉通过自定义变量控制
- 为后续暗色模式、多主题、个性化皮肤预留空间

**模板结构（最终状态）**

```
app/templates/
├── base.html                     # 唯一基础模板（html/head/body 骨架）
├── includes/
│   ├── style.html                # 统一引入所有 CSS（Bootstrap + custom.css + 主题）
│   ├── js.html                   # 统一引入所有 JS（Bootstrap bundle + custom）
│   ├── nav.html                  # 主导航栏（顶部固定）
│   ├── header.html               # 系统标题 / 品牌区域（与 nav 同步显示）
│   ├── footer.html               # 底部版权、版本信息
│   └── flash_messages.html       # flash 消息统一渲染（Bootstrap alert）
```

**关键控制机制**

- 导航栏与页头显示控制：
  - 在 base.html 中使用：
    ```jinja
    {% if show_nav|default(true) %}
        {% include "includes/nav.html" %}
        {% include "includes/header.html" %}
    {% endif %}
    ```
  - 登录页等公共页面只需在模板顶部写：
    ```jinja
    {% set show_nav = false %}
    ```

**CSS 文件结构与职责**

```
app/static/css/
├── custom.css                    # 唯一入口文件，@import 其他 css
├── base.css                      # reset、通用布局、组件基础规则、页面专属样式区
└── themes/
    ├── variables.css             # 仅声明 :root 变量名称（不赋值）
    ├── default.css               # 默认主题（主色 #2563eb）变量赋值 + 少量覆盖
    └── （未来）dark.css / deep-blue.css / indigo.css 等
```

**加载顺序（custom.css 内部）**

1. @import "./themes/variables.css";  
2. @import "./base.css";  
3. @import "./themes/default.css";

**视觉规范（管理后台导向）**

- 主色：#2563eb（科技蓝）
- 交互态：hover #1d4ed8，active #1e3a8a，focus ring rgba(37,99,235,0.25)
- 成功绿：#10b981
- 警告黄：#f59e0b
- 危险红：#ef4444
- 页面背景：#f8fafc / #fafafa
- 卡片/表面：#ffffff
- 边框：#e2e8f0
- 文字主色：#111827
- 文字次色：#4b5563 / #6b7280
- 圆角：6px（主要）、4px（小组件）、8px（部分区域）
- 阴影：sm ~ md 级别（轻到中）
- 间距系统：4px 倍数（4/8/12/16/20/24/32/40/48/64）
- 字体栈：PingFang SC / Helvetica Neue / Arial / sans-serif
- 字号层级：14px（正文）、16px（base）、18px、20px、24px（标题）

**已实现特性**

- 固定顶部导航栏 + scrolled 状态变化
- Logo / 品牌名强制不透明处理（多重 !important + filter: none）
- 统一 flash 消息（可关闭 alert）
- Bootstrap Icons 引入，支持全站图标使用
- 响应式适配（Bootstrap 网格 + 媒体查询补充）
- 页面专属样式区（base.css 末尾），便于针对特定页面微调而不污染全局

**未来扩展方向**

- 支持暗色模式（独立 dark.css 主题）
- 用户手动切换主题（User 模型增加 theme 字段）
- 动态加载主题（<link id="theme-link"> + JS 切换）
- 部门/项目级主题、品牌客制化
- 无障碍支持（high-contrast 主题）

**当前前端文件结构（核心部分）**

```
app/templates/
├── base.html
├── includes/
│   ├── style.html
│   ├── js.html
│   ├── nav.html
│   ├── header.html
│   ├── footer.html
│   └── flash_messages.html
└── auth/
    └── login.html
└── main/
    └── dashboard.html

app/static/css/
├── custom.css
├── base.css
└── themes/
    ├── variables.css
    └── default.css
```

此架构已完成基础搭建，可直接用于后续业务页面开发（登录页已适配，仪表盘、项目列表、计算器等页面可继承使用）。
```

如果你对这个新增章节的内容、深度、表述有任何调整需求（比如想更详细说明某个部分、删除某些内容、增加截图说明等），可以直接告诉我，我会继续修改。  

如果没问题，我们可以继续下一个开发步骤了。
