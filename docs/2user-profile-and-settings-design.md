以下是针对 **FFE 项目跟进系统** 的 **个人资料（/profile）** + **偏好设置（/settings）** 功能的完整方案，已根据所有讨论内容重新整理并统一表述。

（当前日期：2026年2月12日）

## 总体设计原则

- 采用**两个独立页面**方案：
  - `/profile`：个人资料（**纯展示**，用户不可修改）
  - `/settings`：用户可自行修改的偏好设置 + 账号安全（含修改密码）
- 不显示、不支持任何头像相关功能
- 不支持多语言切换（固定使用中文界面）
- 修改密码必须验证旧密码
- 个人资料所有字段**仅限系统管理员**在后台修改（admin 后台功能，后续实现）
- 主题切换改为选择具体的主题 CSS 文件名（默认 `default.css`）
- 视觉风格：**不使用 form-floating**，继承系统现有主题设计与 CSS 变量

## 页面职责与导航定位

| 路径          | 中文名称     | 页面性质           | 用户是否可编辑 | 导航建议位置                              |
|---------------|--------------|--------------------|----------------|-------------------------------------------|
| `/profile`    | 个人资料     | 只读信息展示       | 否             | 侧边栏「个人中心」或右上角用户下拉菜单第一项 |
| `/settings`   | 设置         | 可编辑偏好 + 安全  | 是             | 侧边栏「设置」或「个人中心」→「设置」     |

**推荐右上角用户下拉菜单内容**（已登录状态）：

- 个人资料
- 设置
- 退出登录

## 个人资料页（/profile） — 只读展示

**页面目标**：让用户清晰查看自己的账号信息，无任何修改入口。

**显示字段清单**（建议垂直排列或分卡片展示）

| 顺序 | 中文名称     | 数据库字段名     | 显示格式                     | 备注与特殊处理                             |
|------|--------------|------------------|------------------------------|--------------------------------------------|
| 1    | 用户名       | username         | 纯文本（加粗/大字体）        | 核心标识，最醒目                           |
| 2    | 显示名称     | display_name     | 纯文本                       | 若为空则显示 username                      |
| 3    | 真实姓名     | full_name        | 纯文本                       | —                                          |
| 4    | 邮箱         | email            | 纯文本（可做 mailto: 链接）  | 点击尝试打开邮件客户端                     |
| 5    | 手机号       | phone            | 纯文本                       | —                                          |
| 6    | 部门         | department       | 纯文本                       | —                                          |
| 7    | 职位         | job_title        | 纯文本                       | —                                          |
| 8    | 所在地       | location         | 纯文本                       | 可用于未来时区参考                         |
| 9    | 个人简介     | bio              | 多行文本（支持换行）         | 限制显示高度，超长可使用“展开”按钮         |
| 10   | 注册时间     | created_at       | YYYY-MM-DD HH:MM             | —                                          |
| 11   | 最后登录时间 | last_login_at    | YYYY-MM-DD HH:MM 或 “从未登录” | 若为空显示友好提示                       |

**布局建议**：

- 使用 1–3 个 Bootstrap card（例如一个主卡片 + 工作信息卡片）
- 字段采用左右两列：左侧 label（加粗或有颜色），右侧值
- 页面底部添加一行小提示文字：

  > 如需修改个人信息，请联系系统管理员或通过管理员后台进行操作。

**无任何表单、无输入框、无按钮**（仅 GET 请求）

## 设置页（/settings） — 可编辑内容

分为三个逻辑分区，推荐使用 Bootstrap **nav pills**（标签页）或 **accordion**（可折叠）展示。

### 分区 1：界面与显示偏好

| 中文名称           | 数据库字段名     | 类型       | 默认值       | 可选项（下拉列表）                  | 生效方式                     |
|--------------------|------------------|------------|--------------|-------------------------------------|------------------------------|
| 主题选择           | theme_css        | String(100)| default.css  | default.css, dark.css, blue.css, high-contrast.css, …（系统预定义） | 提交后刷新页面生效（推荐简单方案） |
| 每页显示记录数     | items_per_page   | Integer    | 20           | 10、20、50、100                     | 立即影响列表分页             |

**主题切换说明**：

- 主题文件存放路径建议：`static/themes/`
- 页面加载时动态引入：`<link rel="stylesheet" href="/static/themes/{{ current_user.theme_css or 'default.css' }}">`
- 优先采用“提交后刷新页面生效”方案（最可靠、最少前端工作量）

### 分区 2：通知偏好（当前为占位）

| 中文名称   | 数据库字段名   | 类型    | 默认值 | 控件类型   | 备注                               |
|------------|----------------|---------|--------|------------|------------------------------------|
| 站内通知   | notify_web     | Boolean | True   | checkbox   | 是否在系统内显示通知红点/弹窗      |
| 邮件通知   | notify_email   | Boolean | True   | checkbox   | 是否发送关键事件邮件（逻辑后续实现）|

### 分区 3：账号安全 — 修改密码

**独立表单**（建议放在页面最下方，或单独的 accordion/pill 标签页）

| 表单字段   | 是否必填 | 输入类型   | 校验规则（后端强制）                       | 备注                               |
|------------|----------|------------|--------------------------------------------|------------------------------------|
| 当前密码   | 是       | password   | 必须与数据库 hash 匹配                     | —                                  |
| 新密码     | 是       | password   | 长度 ≥ 8，建议包含字母+数字+符号           | 可加前端弱提示，但后端严格校验     |
| 确认新密码 | 是       | password   | 与新密码完全一致                           | —                                  |

**修改密码提交后行为建议**（更安全做法）：

- 成功 → 显示绿色 flash 提示“密码修改成功，请使用新密码重新登录”
- 随后**自动登出**（logout_user() + 重定向到登录页）
- 失败 → 红色 flash 具体错误信息（当前密码错误 / 新密码不符合要求 / 两次输入不一致）

## 视觉与交互通用要求

- **表单风格**：传统 Bootstrap 结构（label 在上方或左侧 + form-control / form-select / form-check）
- **禁止使用** form-floating
- 所有颜色、按钮、卡片风格**完全继承系统现有主题**（CSS 变量、--primary 等）
- 必填项用红色 * 标记
- 主提交按钮：btn-primary（蓝色醒目）
- 次要/取消按钮：btn-outline-secondary
- 响应式：手机端垂直堆叠，输入框占满宽度
- 分区标题：使用 <h5> 或 card-header，带轻微背景色或边框区分
- flash 消息：沿用系统现有风格（绿色成功、红色错误、黄色警告等）

## 安全与权限要点

- 所有路由必须加 `@login_required`
- `/profile` 只有 GET，无 POST
- `/settings` 支持 POST 更新偏好 + 独立 POST 修改密码
- 所有表单使用 Flask-WTF + CSRF 保护
- 密码修改强制校验旧密码
- 敏感操作（如改密码）可后续记录审计日志

## 后续可扩展方向（优先级参考）

- P0：管理员后台实现用户资料编辑功能
- P1：主题文件实际准备（至少 2–3 个主题）
- P2：修改密码成功后自动登出
- P3：通知开关对应的实际发送逻辑
- P4：邮箱修改验证流程（发邮件确认）

如需进一步细化（例如字段在 User 模型中的精确定义、表单类结构建议、路由规划等），请随时告知。
